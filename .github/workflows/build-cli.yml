name: Build CLI Static

on:
  push:
    branches:
      - master
jobs:
  static-build:
    name: Static Build
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        include:
          - os: ubuntu-latest
            artifact_name: dart-bindgen
            asset_name: dart-bindgen-linux-amd64
          - os: macos-latest
            artifact_name: dart-bindgen
            asset_name: dart-bindgen-macos-amd64
          - os: windows-latest
            artifact_name: dart-bindgen.exe
            asset_name: dart-bindgen-windows-amd64.exe
    steps:
      # - name: Cache LLVM and Clang
      #   id: cache-llvm
      #   uses: actions/cache@v2
      #   with:
      #     path: ${{ runner.temp }}/llvm/10.0
      #     key: ${{ matrix.os }}-llvm-10.0
      - name: Compile LLVM and Clang
        uses: shekohex/compile-llvm-action@v0.1.3-alpha
        with:
          version: '10.0'
          directory: ${{ runner.temp }}/llvm/10.0
          cached: ${{ steps.cache-llvm.outputs.cache-hit }}
      - name: Checkout code
        uses: actions/checkout@v2
      - name: Build CLI (Static)
        uses: actions-rs/cargo@v1
        env:
          LIBCLANG_PATH: ${{ runner.temp }}/llvm/10.0/lib
          LLVM_CONFIG_PATH: ${{ runner.temp }}/llvm/10.0/bin/llvm-config
        with:
          command: build
          args: --release --features cli-static
